<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aviator - Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    
    <style>
        :root { --bg-main: #0f1923; --bg-panel: #212d3a; --bg-darker: #1a2430; --text-primary: #ffffff; --text-secondary: #8a99a8; --green: #00c74a; --red: #ff5555; --yellow: #f1c40f; --blue: #5bc0de; }
        * { box-sizing: border-box; } body { font-family: 'Poppins', sans-serif; background-color: #000; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; } .mobile-frame { width: 100%; height: 100%; max-width: 420px; max-height: 900px; background-color: var(--bg-main); display: flex; flex-direction: column; border-radius: 20px; overflow: hidden; position: relative; } .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background-color: var(--bg-darker); flex-shrink: 0; z-index: 10; } .logo { font-weight: 700; color: var(--red); font-size: 1.2em; } .balance-container { display: flex; align-items: center; gap: 5px; font-weight: 600; } .coin { font-size: 1.2em; } .menu-icons { display: flex; gap: 15px; font-size: 1.1em; align-items: center; } #menu-btn, #logout-btn { background: none; border: none; color: var(--text-primary); cursor: pointer; font-size: 1em; } #logout-btn { color: var(--red); }
        .history-bar { display: flex; justify-content: flex-start; gap: 10px; padding: 8px 15px; background-color: var(--bg-darker); overflow-x: auto; white-space: nowrap; flex-shrink: 0; z-index: 10;}
        .history-bar::-webkit-scrollbar { height: 3px; } .history-bar::-webkit-scrollbar-thumb { background: #555; }
        .history-item { font-weight: 500; padding: 2px 5px; border-radius: 4px; } .history-item.low { color: var(--blue); } .history-item.mid { color: var(--yellow); } .history-item.high { color: var(--red); }
        .game-area { flex-grow: 1; position: relative; background: radial-gradient(ellipse at 50% 150%, rgba(20, 107, 204, 0.25) 0%, rgba(15, 25, 35, 0) 60%), var(--bg-main); overflow: hidden; }
        .multiplier, .crash-text { width: 100%; height: 100%; display: none; justify-content: center; align-items: center; font-size: 5em; font-weight: 700; color: var(--text-primary); text-shadow: 0 0 10px rgba(0,0,0,0.5); position: absolute; z-index: 5; }
        .status-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5em; font-weight: 600; color: var(--yellow); text-align: center; }
        .game-area.running .multiplier { display: flex; } .game-area.crashed .multiplier { display: none; }
        #graph-canvas { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        
        #plane { position: absolute; font-size: 2.5em; color: var(--red); text-shadow: 0 0 10px var(--red); transition: opacity 0.2s ease-out; transform: rotate(-15deg); z-index: 2; }
        .explosion { position: absolute; width: 150px; height: 150px; border-radius: 50%; display: none; background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,159,64,1) 35%, rgba(255,85,85,0) 70%); transform: translate(-50%, -50%) scale(0); z-index: 3; }
        .game-area.crashed .explosion { display: block; animation: explosion-effect 0.4s ease-out forwards; }
        @keyframes explosion-effect { 100% { transform: translate(-50%, -50%) scale(2); opacity: 0; } }
        .crash-text { display: none; position: absolute; font-size: 2.5em; font-weight: 600; color: var(--red); z-index: 6; opacity: 0; animation: fade-out 2s ease-in-out forwards; }
        @keyframes fade-out { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-30px); } }
        
        .controls-area { padding: 10px; display: flex; flex-direction: column; gap: 10px; background-color: var(--bg-panel); flex-shrink: 0; z-index: 10; } .bet-panel { background: var(--bg-darker); border-radius: 8px; padding: 8px; } .panel-tabs { display: flex; margin-bottom: 8px; border-bottom: 1px solid var(--bg-panel); } .panel-tab { flex: 1; padding: 5px; font-size: 0.9em; background: transparent; border: none; color: var(--text-secondary); cursor: pointer; } .panel-tab.active { border-bottom: 2px solid var(--green); color: var(--text-primary); } .panel-body { display: flex; gap: 10px; margin-bottom: 8px; } .bet-input-group { flex: 2; display: flex; } .bet-amount, .auto-cashout-input { width: 100%; text-align: center; font-size: 1.1em; font-weight: 600; background: var(--bg-panel); color: var(--text-primary); border: 1px solid var(--bg-main); border-left: none; border-right: none; } .amount-btn { background: var(--bg-panel); border: 1px solid var(--bg-main); color: var(--text-primary); font-size: 1.2em; padding: 5px 12px; } .amount-btn.minus { border-radius: 5px 0 0 5px; } .amount-btn.plus { border-radius: 0 5px 5px 0; } .quick-bets { flex: 1; display: flex; gap: 5px; } .quick-bet-btn { flex: 1; background: var(--bg-panel); color: var(--text-secondary); border: none; border-radius: 5px; font-size: 0.8em; } .auto-panel-body { display: none; gap: 10px; align-items: center; margin-bottom: 8px; } .auto-cashout-input { border-radius: 5px; } .bet-btn { width: 100%; padding: 10px; font-size: 1.1em; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; background-color: var(--green); color: var(--text-primary); display: flex; flex-direction: column; align-items: center; transition: background-color 0.3s; } .bet-btn .bet-value { font-size: 0.8em; opacity: 0.8; } .bet-btn.cashout { background-color: var(--yellow); } .bet-btn.disabled { background-color: #555; cursor: not-allowed; } .bet-btn.pending { background-color: var(--blue); } .live-stats-area { background-color: var(--bg-darker); height: 180px; overflow-y: auto; padding: 0 10px 10px 10px; flex-shrink: 0; } .live-stats-table { width: 100%; border-collapse: collapse; font-size: 0.8em; } .live-stats-table th, .live-stats-table td { padding: 8px 5px; text-align: left; border-bottom: 1px solid var(--bg-panel); } .live-stats-table th { color: var(--text-secondary); font-weight: 500; } .live-stats-table td { color: var(--text-primary); } .live-stats-table .player-col { width: 40%; } .live-stats-table .bet-col { width: 20%; } .live-stats-table .multi-col { width: 20%; } .cashed-out { color: var(--green) !important; } .lost-bet { color: var(--red) !important; } #my-bets-content, #top-content { display: none; } .bottom-tabs { display: flex; background: var(--bg-darker); flex-shrink: 0; border-top: 1px solid var(--bg-main); } .bottom-tab { flex: 1; padding: 10px; font-size: 0.9em; background: transparent; border: none; color: var(--text-secondary); cursor: pointer; } .bottom-tab.active { border-top: 2px solid var(--green); color: var(--text-primary); } #all-bets-count { color: var(--text-secondary); margin-left: 5px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 100; display: none; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-panel); padding: 20px; border-radius: 10px; z-index: 101; width: 85%; max-width: 350px; display: none; flex-direction: column; gap: 15px; } .modal h3 { text-align: center; margin: 0 0 10px 0; color: var(--text-primary); } .modal .instruction { text-align: center; color: var(--yellow); font-size: 0.9em; } .modal-input, .modal select { width: 100%; padding: 12px; background: var(--bg-darker); border: 1px solid var(--bg-main); border-radius: 5px; color: var(--text-primary); font-size: 1em; } .modal-btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer; } .modal-btn.deposit-btn, .modal-btn.confirm-deposit { background-color: var(--green); color: var(--text-primary); } .modal-btn.withdraw-btn, .modal-btn.confirm-withdraw { background-color: var(--blue); color: var(--text-primary); }
        #menu-modal .modal-btn { background-color: var(--bg-darker); color: var(--text-primary); text-align: left; padding-left: 20px; } #bonus-modal-content { text-align: center; } #bonus-icon { font-size: 5em; color: var(--yellow); text-shadow: 0 0 15px var(--yellow); } #bonus-amount-text { font-size: 2.5em; font-weight: 700; margin: 10px 0; } #bonus-title-text { color: var(--text-secondary); margin-bottom: 20px; } #claim-bonus-btn { background-color: var(--green); } #history-modal-content { max-height: 400px; overflow-y: auto; } #history-modal-content h3 { margin-bottom: 15px; } .history-table { width: 100%; font-size: 0.9em; border-collapse: collapse; } .history-table td { padding: 5px; border-bottom: 1px solid var(--bg-main); } .status-approved { color: var(--green); } .status-rejected { color: var(--red); } .status-pending { color: var(--yellow); }
    </style>
</head>
<body>
    <div class="mobile-frame">
        <div class="top-bar"><span class="logo">Aviator</span><div class="balance-container"><span class="coin">üí∞</span><span id="balance">0.00 ‡¶ü‡¶æ‡¶ï‡¶æ</span></div><div class="menu-icons"><button id="menu-btn"><i class="fa-solid fa-bars"></i></button><button id="logout-btn"><i class="fa-solid fa-right-from-bracket"></i></button></div></div>
        <div class="history-bar" id="history-bar"></div>
        <div class="game-area">
            <canvas id="graph-canvas"></canvas>
            <i class="fa-solid fa-plane-up" id="plane"></i>
            <div class="explosion"></div>
            <div class="crash-text"></div>
            <div class="multiplier" id="multiplier">1.00x</div>
            <div class="status-text" id="status-text">Connecting...</div>
        </div>
        <div class="controls-area"><div class="bet-panel" id="panel-0"><div class="panel-tabs"><button class="panel-tab active" data-tab="bet">Bet</button><button class="panel-tab" data-tab="auto">Auto</button></div><div class="panel-body"><div class="bet-input-group"><button class="amount-btn minus">-</button><input type="number" class="bet-amount" value="10.00"><button class="amount-btn plus">+</button></div><div class="quick-bets"><button class="quick-bet-btn">10</button><button class="quick-bet-btn">50</button><button class="quick-bet-btn">100</button><button class="quick-bet-btn">500</button></div></div><div class="auto-panel-body"><label for="auto-cashout-0" style="color: var(--text-secondary);">Auto Cashout:</label><input type="number" id="auto-cashout-0" class="auto-cashout-input" value="2.00" step="0.1"></div><button class="bet-btn"><span class="bet-text">BET</span><span class="bet-value">10.00 ‡¶ü‡¶æ‡¶ï‡¶æ</span></button></div></div>
        <div class="bottom-tabs"><button class="bottom-tab active" data-tab="all-bets">All Bets <span id="all-bets-count">(0)</span></button><button class="bottom-tab" data-tab="my-bets">My Bets</button><button class="bottom-tab" data-tab="top">Top</button></div>
        <div class="live-stats-area"><div id="all-bets-content"><table class="live-stats-table"><thead><tr><th class="player-col">Player</th><th class="bet-col">Bet</th><th class="multi-col">Multiplier</th></tr></thead><tbody id="all-bets-body"></tbody></table></div><div id="my-bets-content"><table class="live-stats-table"><thead><tr><th class="player-col">Round</th><th class="bet-col">Bet</th><th class="multi-col">Winnings</th></tr></thead><tbody id="my-bets-body"></tbody></table></div><div id="top-content"><p style="color: var(--text-secondary); text-align: center; margin-top: 20px;">Top players feature coming soon.</p></div></div>
    </div>
    <div class="modal-overlay" id="modal-overlay"></div>
    <div class="modal" id="menu-modal">
        <button id="deposit-menu-btn" class="modal-btn"><i class="fa-solid fa-wallet"></i> Deposit</button>
        <button id="withdraw-menu-btn" class="modal-btn"><i class="fa-solid fa-money-bill-wave"></i> Withdraw</button>
        <button id="bonus-menu-btn" class="modal-btn"><i class="fa-solid fa-gift"></i> Bonus</button>
        <button id="deposit-history-btn" class="modal-btn"><i class="fa-solid fa-arrow-down"></i> Deposit History</button>
        <button id="withdraw-history-btn" class="modal-btn"><i class="fa-solid fa-arrow-up"></i> Withdrawal History</button>
    </div>
    <div class="modal" id="deposit-modal"><h3>Deposit</h3><p class="instruction" id="deposit-instruction"></p><select class="modal-input" id="deposit-method"></select><input type="number" class="modal-input" id="deposit-amount" placeholder="Deposit Amount"><input type="text" class="modal-input" id="deposit-trx-id" placeholder="Transaction ID"><button class="modal-btn confirm-deposit">Confirm Deposit</button></div>
    <div class="modal" id="withdraw-modal"><h3>Withdraw</h3><input type="number" class="modal-input" id="withdraw-amount" placeholder="Withdraw Amount"><select class="modal-input" id="withdraw-method"><option value="bKash">bKash</option><option value="Nagad">Nagad</option></select><input type="text" class="modal-input" id="withdraw-number" placeholder="Your bKash/Nagad Number"><button class="modal-btn confirm-withdraw">Confirm Withdraw</button></div>
    <div class="modal" id="bonus-modal"><div id="bonus-modal-content"><div id="bonus-icon"><i class="fa-solid fa-gift"></i></div><p id="bonus-amount-text"></p><p id="bonus-title-text"></p><button id="claim-bonus-btn" class="modal-btn">Claim Now</button></div></div>
    <div class="modal" id="history-modal"><h3></h3><div id="history-modal-content"><table id="history-table" class="history-table"><tbody></tbody></table></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getDatabase, ref, onValue, set, get, update, push, remove, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
        const firebaseConfig = { apiKey: "AIzaSyDg1GQ-TApuxhLSKnQu3YMmjXP6_xXlTig", authDomain: "aviator-96468.firebaseapp.com", databaseURL: "https://aviator-96468-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "aviator-96468", storageBucket: "aviator-96468.firebasestorage.app", messagingSenderId: "265192541811", appId: "1:265192541811:web:6bdb146496593473fce406" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userSnapshot = await get(ref(db, `users/${user.uid}`));
                if (userSnapshot.exists() && userSnapshot.val().isBlocked) {
                    alert("Your account has been blocked.");
                    signOut(auth);
                } else {
                    runGame(user);
                }
            } else {
                window.location.href = 'index.html';
            }
        });

        function runGame(user) {
            const currentUserId = user.uid;
            const userRef = ref(db, `users/${currentUserId}`);
            const canvas = document.getElementById('graph-canvas'), ctx = canvas.getContext('2d');
            const balanceEl = document.getElementById('balance');
            const plane = document.getElementById('plane');
            let balance = 0, lastUpdateTime;
            const multiplierEl = document.getElementById('multiplier'), statusTextEl = document.getElementById('status-text'); const historyBar = document.getElementById('history-bar'); const explosionEl = document.querySelector('.explosion'); const allBetsBody = document.getElementById('all-bets-body'); const myBetsBody = document.getElementById('my-bets-body'); const allBetsCountEl = document.getElementById('all-bets-count'); const crashTextEl = document.querySelector('.crash-text'); let gameState = 'waiting', multiplier = 1.00, gameLoopInterval, playerCountInterval, presetCrashString; const gameHistory = []; const myBetHistory = []; let totalPlayers = 0, initialTotalPlayers = 0, targetEndPlayers = 0; const panelStates = [{ betAmount: 10.00, hasPlacedBet: false, hasCashedOut: false, isAuto: false, autoCashOutAt: 2.00 }];
            
            let previousPosition = {x: 0, y: canvas.height};
            function updatePlaneAnimation() {
                const elapsed = (multiplier - 1) * 10;
                const pathHeight = canvas.height * 0.7; 
                const endX = (elapsed * (canvas.width / 100));
                const endY = canvas.height - Math.min(pathHeight, Math.pow(elapsed, 1.6) + (Math.sin(elapsed / 5) * 15));
                plane.style.left = `${endX - 15}px`; plane.style.top = `${endY - 15}px`;
                ctx.beginPath(); ctx.moveTo(previousPosition.x, previousPosition.y); ctx.lineTo(endX, endY); ctx.strokeStyle = 'rgba(255, 85, 85, 0.2)'; ctx.lineWidth = 3; ctx.stroke();
                previousPosition = {x: endX, y: endY};
            }

            const modalOverlay = document.getElementById('modal-overlay'); const menuBtn = document.getElementById('menu-btn'); const menuModal = document.getElementById('menu-modal'); const bonusMenuBtn = document.getElementById('bonus-menu-btn'); const depositHistoryBtn = document.getElementById('deposit-history-btn'); const withdrawHistoryBtn = document.getElementById('withdraw-history-btn'); const historyModal = document.getElementById('history-modal'); const depositMenuBtn = document.getElementById('deposit-menu-btn'); const withdrawMenuBtn = document.getElementById('withdraw-menu-btn');
            
            let depositSettings = {}; const depositMethodSelect = document.getElementById('deposit-method'); const depositInstruction = document.getElementById('deposit-instruction');
            onValue(ref(db, 'depositSettings'), (snapshot) => { if (snapshot.exists()) { depositSettings = snapshot.val(); depositMethodSelect.innerHTML = ''; Object.keys(depositSettings).forEach(key => { const option = document.createElement('option'); option.value = key; option.textContent = key; depositMethodSelect.appendChild(option); }); updateDepositInstruction(); } });
            function updateDepositInstruction() { const selected = depositSettings[depositMethodSelect.value]; if (selected) { depositInstruction.innerHTML = `<strong>${selected.number}</strong> ‡¶è‡¶á ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá ${selected.type} ‡¶ï‡¶∞‡ßÅ‡¶®`; } }
            depositMethodSelect.addEventListener('change', updateDepositInstruction);
            
            menuBtn.addEventListener('click', () => { modalOverlay.style.display = 'block'; menuModal.style.display = 'flex'; });
            modalOverlay.addEventListener('click', () => { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); modalOverlay.style.display = 'none'; });
            depositMenuBtn.addEventListener('click', () => { menuModal.style.display = 'none'; document.getElementById('deposit-modal').style.display = 'flex'; });
            withdrawMenuBtn.addEventListener('click', () => { menuModal.style.display = 'none'; document.getElementById('withdraw-modal').style.display = 'flex'; });
            bonusMenuBtn.addEventListener('click', async () => { const snap = await get(ref(db, `users/${currentUserId}/bonus`)); if (snap.exists()) { const data = snap.val(); document.getElementById('bonus-amount-text').textContent = `${data.amount} ‡¶ü‡¶æ‡¶ï‡¶æ`; document.getElementById('bonus-title-text').textContent = data.title; menuModal.style.display = 'none'; document.getElementById('bonus-modal').style.display = 'flex'; } else { alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡ßá‡¶á‡•§"); } });
            document.getElementById('claim-bonus-btn').addEventListener('click', async () => { const bonusRef = ref(db, `users/${currentUserId}/bonus`); const snap = await get(bonusRef); if (snap.exists()) { const newBalance = balance + snap.val().amount; await update(userRef, { balance: newBalance }); await remove(bonusRef); alert("‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); modalOverlay.click(); } });
            async function showHistory(type) { const tableBody = document.getElementById('history-table').querySelector('tbody'); tableBody.innerHTML = '<tr><td>Loading...</td></tr>'; menuModal.style.display = 'none'; historyModal.style.display = 'flex'; historyModal.querySelector('h3').textContent = `${type.charAt(0).toUpperCase() + type.slice(1)} History`; const userTxQuery = query(ref(db, 'transactions'), orderByChild('userId'), equalTo(currentUserId)); const snapshot = await get(userTxQuery); tableBody.innerHTML = ''; let found = false; if (snapshot.exists()) { snapshot.forEach(child => { const tx = child.val(); if (tx.type === type) { found = true; const date = new Date(tx.timestamp).toLocaleDateString('bn-BD'); tableBody.innerHTML += `<tr><td>${date}</td><td>${tx.amount} ‡¶ü‡¶æ‡¶ï‡¶æ</td><td class="status-${tx.status}">${tx.status}</td></tr>`; } }); } if (!found) { tableBody.innerHTML = '<tr><td>‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á</td></tr>'; } }
            depositHistoryBtn.addEventListener('click', () => showHistory('deposit')); withdrawHistoryBtn.addEventListener('click', () => showHistory('withdrawal'));
            document.getElementById('logout-btn').addEventListener('click', () => { signOut(auth); });
            onValue(userRef, (snapshot) => { if(!snapshot.exists()) return; balance = snapshot.val().balance || 0; balanceEl.textContent = `${balance.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ`; });
            let fakePlayers = []; const playerNames = ['Player123', 'ProGamer', 'Lucky7', 'HighRoller', 'BetMaster', 'Winner99', 'AviatorGod', 'FlyHigh', 'SkyKing', 'RiskTaker']; function initializeFakePlayers() { fakePlayers = playerNames.map(name => ({ name, balance: 5000 + Math.random() * 15000, currentBet: 0, cashOutAt: 0, cashedOut: false })); } function generateFakeBets() { fakePlayers.forEach(p => { p.cashedOut = false; p.currentBet = (1500 + Math.random() * 3500).toFixed(2); p.cashOutAt = (1.1 + Math.random() * 5).toFixed(2); }); updateAllBetsDisplay(); } function updateAllBetsDisplay() { fakePlayers.sort((a, b) => b.balance - a.balance); allBetsBody.innerHTML = ''; fakePlayers.forEach(p => { const row = document.createElement('tr'); row.innerHTML = `<td>${p.name}</td><td>${p.currentBet} ‡¶ü‡¶æ‡¶ï‡¶æ</td><td id="player-${p.name}">-</td>`; allBetsBody.appendChild(row); }); }
            async function startGame() { gameState = 'running'; multiplier = 1.00; plane.style.opacity = 1; previousPosition = {x: 0, y: canvas.height}; crashTextEl.style.display = 'none'; const queueRef = ref(db, 'game-control/crashQueue'); const queueSnap = await get(queueRef); const queue = queueSnap.val() || []; if (queue.length > 0) { presetCrashString = queue.shift(); canvas.dataset.crashPoint = parseFloat(presetCrashString.replace('x', '')); set(queueRef, queue); } else { const singleRef = ref(db, 'game-control/nextCrashPoint'); const singleSnap = await get(singleRef); let cp = singleSnap.val(); if (cp > 1.0) { presetCrashString = `${cp.toFixed(2)}x`; canvas.dataset.crashPoint = cp; set(singleRef, 0); } else { presetCrashString = null; canvas.dataset.crashPoint = (1 + Math.random() * 5 + (Math.random() > 0.9 ? Math.random() * 10 : 0)).toFixed(2); } } statusTextEl.style.display = 'none'; canvas.parentElement.classList.add('running'); lastUpdateTime = Date.now(); gameLoopInterval = setInterval(gameLoop, 50); playerCountInterval = setInterval(() => { if (gameState === 'running' && totalPlayers > targetEndPlayers) { const playersToDrop = Math.floor(2 + Math.random() * 8); totalPlayers = Math.max(targetEndPlayers, totalPlayers - playersToDrop); allBetsCountEl.textContent = `(${totalPlayers})`; } }, 300); }
            function resetGame() { if (playerCountInterval) clearInterval(playerCountInterval); gameState = 'betting'; canvas.parentElement.classList.remove('running', 'crashed'); explosionEl.style.display = 'none'; panelStates[0].hasPlacedBet = false; panelStates[0].hasCashedOut = false; initialTotalPlayers = Math.floor(3000 + Math.random() * 6000); totalPlayers = initialTotalPlayers; targetEndPlayers = Math.floor(initialTotalPlayers * (0.4 + Math.random() * 0.2)); allBetsCountEl.textContent = `(${totalPlayers})`; let count = 5; statusTextEl.style.display = 'block'; const interval = setInterval(() => { count -= 0.1; if (count > 0) statusTextEl.textContent = `Round starts in ${count.toFixed(1)}s...`; else { clearInterval(interval); startGame(); } }, 100); updateButtonsUI(); generateFakeBets(); ctx.clearRect(0,0,canvas.width,canvas.height); updatePlaneAnimation(); }
            function gameLoop() { const now = Date.now(); const deltaTime = now - lastUpdateTime; lastUpdateTime = now; multiplier += (0.01 / 50) * deltaTime; multiplierEl.textContent = `${multiplier.toFixed(2)}x`; updatePlaneAnimation(); updateButtonsUI(); if (panelStates[0].isAuto && panelStates[0].hasPlacedBet && !panelStates[0].hasCashedOut && multiplier >= panelStates[0].autoCashOutAt) { cashOut(0); } fakePlayers.forEach(p => { if (p.currentBet > 0 && !p.cashedOut && multiplier >= p.cashOutAt) { p.cashedOut = true; p.balance += p.currentBet * p.cashOutAt; const cell = document.getElementById(`player-${p.name}`); if(cell) { cell.textContent = `@ ${p.cashOutAt}x`; cell.classList.add('cashed-out'); } } }); const cp = parseFloat(canvas.dataset.crashPoint); if (multiplier >= cp) { clearInterval(gameLoopInterval); clearInterval(playerCountInterval); gameState = 'crashed'; const crashPointText = presetCrashString ? presetCrashString : `${cp.toFixed(2)}x`; explosionEl.style.left = `${plane.offsetLeft + 15}px`; explosionEl.style.top = `${plane.offsetTop + 15}px`; canvas.parentElement.classList.add('crashed'); plane.style.opacity = 0; crashTextEl.textContent = crashPointText; crashTextEl.style.left = `${plane.offsetLeft - 15}px`; crashTextEl.style.top = `${plane.offsetTop - 15}px`; crashTextEl.style.display = 'block'; updateHistory(crashPointText); if (panelStates[0].hasPlacedBet && !panelStates[0].hasCashedOut) { myBetHistory.push({ betAmount: panelStates[0].betAmount, multiplier: cp, winnings: -panelStates[0].betAmount }); updateMyBetsDisplay(); } fakePlayers.forEach(p => { if (p.currentBet > 0 && !p.cashedOut) { const cell = document.getElementById(`player-${p.name}`); if (cell) cell.classList.add('lost-bet'); p.balance -= p.currentBet; } }); setTimeout(resetGame, 2000); } }
            async function cashOut(index) { const state = panelStates[index]; if (gameState !== 'running' || !state.hasPlacedBet || state.hasCashedOut) return; const winAmount = state.betAmount * multiplier; state.hasCashedOut = true; state.cashedOutAmount = winAmount; await update(userRef, { balance: balance + winAmount }); myBetHistory.push({ betAmount: state.betAmount, multiplier: multiplier, winnings: winAmount - state.betAmount }); updateMyBetsDisplay(); updateButtonsUI(); }
            function updateHistory(newCrashPointText) { gameHistory.unshift(newCrashPointText); if (gameHistory.length > 20) { gameHistory.pop(); } historyBar.innerHTML = ''; gameHistory.forEach(m => { const i = document.createElement('span'); i.textContent = m; i.classList.add('history-item'); const val = parseFloat(m); if (val < 2) i.classList.add('low'); else if (val < 10) i.classList.add('mid'); else i.classList.add('high'); historyBar.appendChild(i); }); }
            const betBtn = document.querySelector('.bet-btn'); betBtn.addEventListener('click', async () => { const s = panelStates[0]; if (gameState === 'betting') { if (s.hasPlacedBet) { await update(userRef, { balance: balance + s.betAmount }); s.hasPlacedBet = false; } else { if (balance >= s.betAmount && s.betAmount > 0) { await update(userRef, { balance: balance - s.betAmount }); s.hasPlacedBet = true; } else { alert("‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£!"); } } } else if (gameState === 'running') { cashOut(0); } updateButtonsUI(); });
            document.querySelector('.confirm-deposit').addEventListener('click', () => { const a = parseFloat(document.getElementById('deposit-amount').value); const m = document.getElementById('deposit-method').value; const t = document.getElementById('deposit-trx-id').value; if (!a || !t || a <= 0) { alert("Please fill all fields correctly."); return; } push(ref(db, 'transactions'), { userId: currentUserId, amount: a, type: 'deposit', status: 'pending', method: m, details: t, timestamp: Date.now() }); alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßÅ‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'); modalOverlay.click(); });
            document.querySelector('.confirm-withdraw').addEventListener('click', async () => { const a = parseFloat(document.getElementById('withdraw-amount').value); const m = document.getElementById('withdraw-method').value; const n = document.getElementById('withdraw-number').value; if (!a || !n || a <= 0) { alert("Please fill all fields correctly."); return; } if (a > balance) { alert("‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏!"); return; } await update(userRef, { balance: balance - a }); push(ref(db, 'transactions'), { userId: currentUserId, amount: a, type: 'withdrawal', status: 'pending', method: m, details: n, timestamp: Date.now() }); alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßÅ‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'); modalOverlay.click(); });
            function resizeCanvas() { canvas.width = canvas.parentElement.clientWidth; canvas.height = canvas.parentElement.clientHeight; } resizeCanvas(); window.addEventListener('resize', resizeCanvas);
            function updateMyBetsDisplay() { myBetsBody.innerHTML = ''; myBetHistory.slice().reverse().forEach(bet => { const r = document.createElement('tr'); const w = bet.winnings > 0 ? bet.winnings : bet.winnings * -1; const c = `<td class="${bet.winnings > 0 ? 'cashed-out' : 'lost-bet'}">${bet.winnings > 0 ? '+' : '-'}${w.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ</td>`; r.innerHTML = `<td>@ ${bet.multiplier.toFixed(2)}x</td><td>${bet.betAmount.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ</td>${c}`; myBetsBody.appendChild(r); });}
            function updateButtonsUI() { const s = panelStates[0]; const b = document.querySelector('.bet-btn'); const t = b.querySelector('.bet-text'); const v = b.querySelector('.bet-value'); b.disabled = false; b.classList.remove('disabled', 'cashout', 'pending'); if (gameState === 'betting') { if (s.hasPlacedBet) { b.classList.add('pending'); t.textContent = 'CANCEL'; } else { t.textContent = 'BET'; } } else if (gameState === 'running') { if (s.hasPlacedBet) { if (s.hasCashedOut) { b.disabled = true; b.classList.add('disabled'); t.textContent = 'CASHED OUT'; v.textContent = `+${(s.cashedOutAmount - s.betAmount).toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ`; } else { b.classList.add('cashout'); t.textContent = 'CASH OUT'; v.textContent = `${(s.betAmount * multiplier).toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ`; } } else { b.disabled = true; b.classList.add('disabled'); } } else { b.disabled = false; t.textContent = 'BET'; v.textContent = `${s.betAmount.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ`; } }
            document.querySelectorAll('.bet-panel').forEach((p, i) => { const s = panelStates[i]; const inp = p.querySelector('.bet-amount'); const val = p.querySelector('.bet-value'); function u() { const a = parseFloat(inp.value); if (isNaN(a) || a <= 0) return; s.betAmount = a; val.textContent = `${a.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ`; } p.querySelector('.minus').addEventListener('click', () => { let a = parseFloat(inp.value); if (a > 10) a -= 10; inp.value = a.toFixed(2); u(); }); p.querySelector('.plus').addEventListener('click', () => { let a = parseFloat(inp.value); inp.value = (a + 10).toFixed(2); u(); }); p.querySelectorAll('.quick-bet-btn').forEach(b => { b.addEventListener('click', () => { inp.value = parseFloat(b.textContent).toFixed(2); u(); }); }); inp.addEventListener('input', u); p.querySelectorAll('.panel-tab').forEach(t => { t.addEventListener('click', () => { p.querySelectorAll('.panel-tab').forEach(x => x.classList.remove('active')); t.classList.add('active'); const isAuto = t.dataset.tab === 'auto'; s.isAuto = isAuto; p.querySelector('.auto-panel-body').style.display = isAuto ? 'flex' : 'none'; }); }); });
            const bottomTabs = document.querySelectorAll('.bottom-tab'); const tabContents = document.querySelectorAll('.live-stats-area > div'); bottomTabs.forEach(tab => { tab.addEventListener('click', () => { bottomTabs.forEach(t => t.classList.remove('active')); tab.classList.add('active'); tabContents.forEach(c => c.style.display = 'none'); document.getElementById(`${tab.dataset.tab}-content`).style.display = 'block'; }); });
            
            initializeFakePlayers(); updateHistory(''); resetGame();
        }
    </script>
</body>
</html>
